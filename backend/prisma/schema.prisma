generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

model User {
    id                   String    @id @default(uuid())
    email                String    @unique
    password             String
    name                 String
    isVerified           Boolean   @default(false)
    verificationToken    String?
    resetPasswordToken   String?
    resetPasswordExpires DateTime?
    avatarUrl            String?
    plan                 String    @default("FREE")
    createdAt            DateTime  @default(now())
    updatedAt            DateTime  @updatedAt

    setupConfig  SetupConfig?
    budgets      Budget[]
    spending     Spending[]
    assets       Asset[]
    userSettings UserSettings?

    @@map("users")
}

model SetupConfig {
    id     String @id @default(uuid())
    userId String @unique
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    accountSummary String[]

    incomeSources String[]

    needs   String[]
    wants   String[]
    savings String[]

    accountAssets String[]

    paydayDate Int @default(1)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("setup_configs")
}

model Budget {
    id     String @id @default(uuid())
    userId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    yearMonth String

    income Json @default("{}")

    savingsAllocation Json @default("{}")

    expenses Json @default("{}")

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([userId, yearMonth])
    @@index([userId, yearMonth])
    @@map("budgets")
}

model Spending {
    id     String @id @default(uuid())
    userId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    date        DateTime
    description String
    category    String
    amount      Decimal  @db.Decimal(15, 2)
    checked     Boolean  @default(false)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([userId, date])
    @@index([userId, category])
    @@map("spending")
}

enum AssetType {
    LIQUID
    NON_LIQUID
}

model Asset {
    id     String @id @default(uuid())
    userId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    type        AssetType
    description String
    value       Decimal   @db.Decimal(15, 2)
    account     String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([userId, type])
    @@map("assets")
}

model UserSettings {
    id     String @id @default(uuid())
    userId String @unique
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    assetsTarget Decimal @default(0) @db.Decimal(15, 2)

    currency String @default("IDR")

    preferences Json @default("{}")

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("user_settings")
}
